uploadBtn.addEventListener('click', async () => {
  if (fileInput.files.length === 0) {
    alert('Please select a folder first!');
    return;
  }

  uploadBtn.disabled = true;
  setResult('📦 Creating ZIP file... Please wait.');

  const zip = new JSZip();

  for (const file of fileInput.files) {
    zip.file(file.webkitRelativePath, file);
  }

  try {
    const zipBlob = await zip.generateAsync({ type: 'blob' });
    setResult('🚀 Uploading ZIP file...');

    const formData = new FormData();
    formData.append('file', zipBlob, 'folder.zip');

    const response = await fetch('https://file.io', {
      method: 'POST',
      body: formData,
    });

    // Check if HTTP status is OK
    if (!response.ok) {
      setResult(`❌ Upload failed: HTTP status ${response.status} ${response.statusText}`);
      uploadBtn.disabled = false;
      return;
    }

    const data = await response.json();

    if (data.success) {
      setResult(
        `✅ Upload successful!<br>
        <a class="download-link" href="${data.link}" target="_blank" rel="noopener noreferrer">Download your ZIP here</a>`
      );
    } else {
      setResult('❌ Upload failed: ' + (data.message || 'Unknown error'));
    }
  } catch (error) {
    console.error('Upload error:', error);
    setResult(`❌ An error occurred during zip or upload: ${error.message}`);
  } finally {
    uploadBtn.disabled = false;
  }
});
